<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Servo Pilot</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #121212;
    color: #e0e0e0;
    margin: 0;
    padding: 15px;
  }
  h1 {
    text-align: left;
    color: #00e5ff;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .status {
    font-size: 14px;
    padding: 5px 10px;
    border-radius: 15px;
  }
  .online { background: #4caf50; color: white; }
  .offline { background: #f44336; color: white; }

  .section-title {
    color: #00e5ff;
    margin: 15px 0 10px;
    font-size: 20px;
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 15px;
  }
  .card {
    background: #1e1e1e;
    border-radius: 10px;
    padding: 15px;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
  }
  .card h3 {
    margin: 10px 0 5px;
  }
  .card img {
    width: 80px;     /* Bild kompakter */
    height: 80px;    /* immer quadratisch */
    object-fit: cover;
    border-radius: 10px;
    margin-bottom: 10px;
  }
  .toggle {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
  }
  .toggle input {
    display: none;
  }
  .slider {
    width: 40px;
    height: 20px;
    background: #555;
    border-radius: 20px;
    position: relative;
    transition: background 0.3s;
  }
  .slider::before {
    content: "";
    position: absolute;
    width: 16px;
    height: 16px;
    top: 2px;
    left: 2px;
    border-radius: 50%;
    background: white;
    transition: transform 0.3s;
  }
  input:checked + .slider {
    background: #4caf50;
  }
  input:checked + .slider::before {
    transform: translateX(20px);
  }
</style>
</head>
<body>
  <h1>Servo Pilot 
    <span id="status" class="status offline">Disconnected</span>
  </h1>

  <div class="section-title">Maschinen</div>
  <div class="grid">
    <div class="card">
      <img src="https://raw.githubusercontent.com/hoedii/PrintSpaceServo/91df36cc64b22325bc207f0c3b66ddbeeb08a8a0/s1_kobra_icon" alt="S1 Kobra">
      <h3>S1 Kobra</h3>
      <label class="toggle">
        <input type="checkbox" onchange="toggleMachine(0,this.checked)">
        <div class="slider"></div>
      </label>
    </div>
    <div class="card">
      <img src="https://raw.githubusercontent.com/hoedii/PrintSpaceServo/91df36cc64b22325bc207f0c3b66ddbeeb08a8a0/h2s_icon" alt="H2S">
      <h3>H2S</h3>
      <label class="toggle">
        <input type="checkbox" onchange="toggleMachine(1,this.checked)">
        <div class="slider"></div>
      </label>
    </div>
  </div>

  <div class="section-title">Servos</div>
  <div class="grid" id="servos"></div>

<script>
const token = "BmmlidjZqiiEfbddzmnQsp_yuHgGMphX";

// Servos fix definiert
let servos = [
  {name:"Servo 1", state:0},
  {name:"Servo 2", state:0},
  {name:"Servo 3", state:0},
  {name:"Servo 4", state:0},
  {name:"Servo 5", state:0},
  {name:"Servo 6", state:0},
];

function renderServos(){
  const container = document.getElementById('servos');
  container.innerHTML = '';
  servos.forEach((s,i)=>{
    const div = document.createElement('div');
    div.className = "card";
    div.innerHTML = `
      <h3>${s.name}</h3>
      <label class="toggle">
        <input type="checkbox" ${s.state?"checked":""} onchange="toggleServo(${i},this.checked)">
        <div class="slider"></div>
      </label>
    `;
    container.appendChild(div);
  });
}

// Servo schalten
function toggleServo(i,state){
  servos[i].state = state?1:0;
  sendCommand("V"+(i+1), servos[i].state);
}

// Maschinen schalten (Maschine 0 = Servos 1-3, Maschine 1 = Servos 4-6)
function toggleMachine(index,state){
  let range = index===0 ? [0,1,2] : [3,4,5];
  range.forEach(i=>{
    servos[i].state = state?1:0;
    sendCommand("V"+(i+1), servos[i].state);
  });
  renderServos();
}

// Blynk Command
function sendCommand(vpin,state){
  fetch(`https://blynk.cloud/external/api/update?token=${token}&${vpin}=${state}`,{mode:"no-cors"});
}

// Status checken
function checkStatus(){
  fetch(`https://blynk.cloud/external/api/isHardwareConnected?token=${token}`)
    .then(r=>r.text())
    .then(t=>{
      const status = document.getElementById("status");
      if(t==="true"){ 
        status.textContent = "Connected";
        status.className = "status online";
      } else {
        status.textContent = "Disconnected";
        status.className = "status offline";
      }
    })
    .catch(()=>{
      const status = document.getElementById("status");
      status.textContent = "Disconnected";
      status.className = "status offline";
    });
}

// Init
renderServos();
checkStatus();
setInterval(checkStatus,5000);
</script>
</body>
</html>
